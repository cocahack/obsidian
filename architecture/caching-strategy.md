---
aliases: [캐싱 전략]
---

# 캐싱 전략

> [!NOTE]
> 이 문서는 [Caching Strategies and How to Choose the Right One](https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/) 를 번역한 것입니다.

## Cache-Aside

애플리케이션이 직접 캐시에 접근하는 방식이다.

1. 애플리케이션은 캐시를 먼저 확인한다.
2. 캐시에 데이터가 있다면 이를 반환한다.
3. 캐시에 데이터가 없다면 데이터베이스에서 데이터를 가져오는 등의 추가 작업을 한다. 그 결과물을 클라이언트에게 반환하고 캐시에 저장한다.

### Use cases

Cache-aside 전략은 일반적인 애플리케이션과 읽기 요청이 많은 워크로드에 적합하다. 여기에는 Memcached나 Redis가 널리 쓰인다. 

### 장단점

- 장점
	- 캐시에 장애가 발생해도 데이터베이스를 이용하여 계속 서비스할 수 있다.
	- 캐시에 저장된 데이터 모델은 데이터베이스의 모델과 같지 않아도 된다. 즉, 여러 개의 쿼리가 조합된 결과를 가질 수도 있다는 뜻이다.
- 단점
	- Cache-aside 전략에서 데이터를 쓸 때는 대부분 데이터베이스에 직접 쓴다. 이는 캐시와 데이터베이스의 일관성을 깨트릴 수 있다.
		- 위의 이유로 캐시의 TTL을 적절히 설정하고, 캐시 invalidation 전략을 잘 수립해야 한다.

## Read-Through Cache

Read-through 전략에서는 캐시가 데이터베이스 앞에 위치한다. 캐시 미스가 발생하면 데이터베이스에서 데이터를 읽어 캐시에 저장하고, 애플리케이션은 캐시로부터 데이터를 반환한다.

Read-aside에서는 애플리케이션이 데이터베이스로부터 데이터를 가져오고 캐시에 넣는 책임을 가지고 있지만, Read-throught에서는 이러한 작업이 라이브러리나 캐시 프로바이더가 담당하게 된다.

또한, Read-aside와 다르게 데이터베이스의 내용을 그대로 캐시하므로 데이터베이스의 모델과 캐시의 모델은 항상 같다.

### Use cases

Read-through 전략은 같은 데이터를 자주 요청하는 워크로드에 적합하다(ex. 뉴스).

### 장단점

- 단점
	- 데이터의 최초 요청은 항상 캐시 미스를 유발한다. 따라서 개발자는 쿼리를 수동으로 실행하는 워밍 등의 작업을 해야 할 수 있다.
	- Read-aside처럼 데이터베이스와 캐시 사이의 일관성이 깨질 수 있다.

## Write-Through Cache

이 쓰기 전략에서는 데이터를 캐시에 먼저 쓰고 그 다음에 데이터베이스에 쓴다. 

### 장단점

- 장점
	- Read-through 전략과 같이 쓰면, read-through 의 장점을 누리면서 데이터 일관성을 보장할 수 있어 캐시 invalidation이 필요하지 않다.
- 단점
	- 실제로는 데이터가 캐시에 먼저 저장된 후 데이터베이스에 저장되므로 쓰기 레이턴시가 추가로 발생한다.

### Use cases

DynamoDB Accelerator(DAX)는 read-through/write-through 캐시의 좋은 예다. DynamoDB와 애플리케이션 사이에 위치하여, DynamoDB의 읽기 및 쓰기 요청이 DAX를 통해 이뤄지는 것이다.

## Write-Around

데이터는 데이터베이스에 바로 쓰여지며, 읽은 데이터만 캐시로 들어간다.

### 장단점

- 장점
	- 저장된 데이터를 거의 읽지 않는 상황에서 read-through 전략과 같이 쓰이면 좋은 퍼포먼스를 낼 수 있다.


### Use cases

실시간 로그나 채팅 메시지에 쓰인다.

## Write-Back

애플리케이션은 캐시에 데이터를 쓰며, 이 때 캐시가 ACK를 애플리케이션에 전달한다. 즉, 애플리케이션은 데이터베이스에 실제로 저장했는지는 신경쓰지 않는다. 일정 시간 후, 캐시에 저장된 데이터는 데이터베이스에 저장된다.

### 장단점

- 장점
	- 쓰기 성능이 중요한 워크로드에 쓰인다.
	- Read-through 전략과 같이 쓰이면 캐시로부터 항상 최신 데이터를 업데이트하고 읽을 수 있다.
	- 데이터베이스 장애에 대한 복원력이 뛰어나고, 일부 데이터베이스의 다운타임을 견딜 수 있다.
	- 배치 또는 병합이 지원된다면, 쓰기 회수로 요금이 청구되는 상품에 대해 비용을 줄일 수 있다.
- 단점
	- 캐시가 죽으면 데이터가 손실된다.

### Use cases

대부분의 RDBMS 엔진은 write-back 캐시를 지원한다.