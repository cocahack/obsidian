# Main concepts

## 핵심 요소

- 메시지, 레코드, 이벤트: "어떤 것이 발생했다"는 사실을 기록하는데 이를 메시지, 레코드 또는 이벤트라고 부른다. 카프카에서 데이터를 읽고 쓸 때 이벤트의 형식을 갖게 된다. 이벤트는 키, 값의 필수 요소와 타임스탬프, 그리고 메타데이터 헤더 등의 부가 요소로 이루어져있다.
- 프로듀서: 카프카로 이벤트를 쓰는 클라이언트 애플리케이션이다. 
- 컨슈머: 이벤트들을 구독하는 클라이언트 애플리케이션이다. 
- 토픽: 카프카는 메세지 피드들을 토픽으로 구분한다. 토픽 이름은 카프카 내에서 유일해야 한다.
- 파티션: 카프카는 하나의 토픽을 여러 개의 파티션으로 나눈다. 카프카는 파티션으로 병렬 처리 및 고성능을 얻었다.
- 세그먼트: 프로듀서가 전송한 실제 메시지는 브로커의 로컬 디스크에 세그먼트로 저장된다.
- 주키퍼: 카프카의 메타데이터 관리 및 브로커의 health check를 담당한다.

## Details

### Replication

카프카에서 토픽은 여러 개의 파티션으로 나뉜다. 그리고 각각의 파티션은 `replication-factor`로 정의한 개수만큼 복제본이 존재한다. 어떤 파티션에 메시지가 도착하면 파티션의 모든 복제본에 메시지가 존재하는 것이다.

Replication으로 하나의 브로커가 다운되어도 카프카는 여전히 동작할 수 있다.

### Partition

파티션을 사용하면 토픽 하나를 여러 개로 나눠 병렬처리 또는 분산처리가 가능하다. 

파티션은 나중에 더 추가할 수 있지만, 한 번 추가된 파티션은 다시 삭제할 수 없으므로 주의가 필요하다. 처음에는 2 또는 4 정도로 파티션 값을 설정하고, 메시지 처리량이나 컨슈머 LAG 등을 모니터링하여 조금씩 늘려나가는 것이 좋다.

> [!INFO]
> 
> 컨슈머 LAG
> 카프카에 남아 있는 메시지 수를 컨슈머가 가져간 메시지 수를 뺀 값이다. LAG으로 컨슈머에 지연이 발생하고 있는지 알 수 있다.

### Segment

프로듀서가 전송한 메시지는 토픽의 파티션에 저장되며, 각 메시지는 세그먼트라는 로그 파일 형태로 브로커의 로컬 디스크에 저장된다. 


## References

- [카프카 공식 문서 - introduction](https://kafka.apache.org/documentation/#introduction)

---
#kafka